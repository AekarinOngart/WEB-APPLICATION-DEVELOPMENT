@{
    Layout = null;
}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet" />
    <link rel="stylesheet" href="~/css/popup.css" />
    <link rel="stylesheet" href="~/css/navbar.css" />
    <title>กิ๋นตวย | POPUP</title>
</head>

<body onload="Startpage()">
    <!--Navbar-->
    <nav>
        <ul>
            <li>
                <img src="~/images/logo.png" alt="logo" id="logo" />
            </li>
            <li>
                <img src="~/images/notification.png" class="notification" onclick="show1('menu1')">
                <ul id="menu1">
                </ul>
                <img src="~/images/profile.png" class="profile" onclick="show('menu')" />
                <ul id="menu">
                    <li class="sub-item">
                        <span class="material-icons-outlined"> grid_view </span>
                        <p>Dashboard</p>
                    </li>
                    <li class="sub-item">
                        <span class="material-icons-outlined">
                            format_list_bulleted
                        </span>
                        <p>My Orders</p>
                    </li>
                    <li class="sub-item">
                        <span class="material-icons-outlined"> manage_accounts </span>
                        <p>Update Profile</p>
                    </li>
                    <li class="sub-item">
                        <span class="material-icons-outlined"> logout </span>
                        <p>Logout</p>
                    </li>
                </ul>
            </li>
        </ul>
    </nav>
    <!--End-Navbar-->
    <div class="content" onclick="showoff(['menu','menu1'])">
        <!--Content-Popup-->
        <div class="popup1" onclick="showoff(['menu','menu1'])">
            <img src="~/images/Kraprao.jfif" alt="logo" class="item-img" />
            <div class="name-item">
                <p id="name0" style="display:inline;"></p>
                <td class="price"><p id="price0" style="display:inline;"></p><p style="display:inline;"> บาท</p></td>
            </div>
            <div class="shop-name">ชื่อร้าน : <p id="shopname" style="display:inline;"></p></div>
            <div class="flex-container">
                <div class="flex-item-left">
                    <p>รายการอาหาร</p>
                    <p style="margin-left: 9%" id="name"></p>
                    <p style="margin-left: 9%">ค่าหิ้ว</p>
                    <p style="margin-left: 9%">รวม</p>
                    <p>ที่อยู่</p>
                </div>
                <div class="flex-item-right">
                    <p>ราคา</p>
                    <p style="margin-left: 9%" id="price"></p>
                    <p style="margin-left: 9%">10</p>
                    <p style="margin-left: 9%" id="bill"></p>
                </div>
            </div>
            <input type="text" name="address" id="address" placeholder="ที่อยู่" required>
            <br>
            <div class="note">
                <div class="mahi">หมายเหต</div>
                <input type="text" id="notes" name="notes" class="box"></input>
            </div>
            <img src="" alt="logo" class="qr" id="pic" />
            <div class="btn">
                <button class="btn-popup-pay" id="pay" onclick="pay()">Pay</button>
                <button class="btn-popup-cancel" id="close">cancel</button>
            </div>
        </div>

        <div class="popup2">
            <div class="pay-cancel">
                <br />
                <img src="~/images/success.png" alt="" class="success" />
                <br />
                <br />
                <h1>ชำระสำเร็จ</h1>
                <br />
                <br />
                <button class="btn-popup-success" id="close2">BACK</button>
            </div>
        </div>
    </div>
    <script src="~/js/effect.js"></script>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script>
        function Startpage() {
            var Ssoid = sessionStorage.getItem("Ssorder");
            console.log(Ssoid)
            $.ajax({
                url: "/PickupOrder/GetAll",
                method: "GET",
                success: function (data) {
                    console.log(data.value[Ssoid])
                    var pick = data.value[Ssoid];
                    var bill = parseInt(pick.price) + 10;
                    //console.log(pick)
                    $("#shopname").text(pick.shopName);
                    $("#name").text(pick.name);
                    $("#name0").text(pick.name);
                    $("#price").text(pick.price);
                    $("#price0").text(pick.price);
                    $("#bill").text(bill)
                    //console.log(pick)
                    document.getElementById("pic").src = pick["qrcode"];
                    var PickupOrderId = pick.PickupOrderId;
                    var PickupOrder_User_UserId = pick.PickupOrder_User_UserId;
                    var bill = bill;
                    Startgetuser(pick.PickupOrderId, PickupOrder_User_UserId, bill);

                },
                error: function (err) {
                    console.error(err);
                }

            })

        }
        
        function Startgetuser(PickupOrderId,PickupOrder_User_UserId,bill) {
            var Location = $("#address").val();
            var Other $("#notes").val();
            var Ssid = sessionStorage.getItem("Ssid")
            console.log(Ssoid)
            $.ajax({
                url: "/User/GetAll",
                method: "GET",
                success: function (data) {
                    console.log(data)
                    var user = data.value[Ssid];
                    //console.log(user)
                    var User_UserId = user.Id;
                    
                    pay(User_UserId, PickupOrder_PickupOrderId, PickupOrder_User_UserId, Location, Other, Bill);
                 
                },
                error: function (err) {
                    console.error(err);
                }

            })
        }


        function pay(User_UserId, PickupOrder_PickupOrderId, PickupOrder_User_UserId, Location, Other, Bill) {
            //var
            //getpost model 3 model

                var obj = {
                    BuyOrderId: 0,
                    User_UserId: User_UserId,
                    PickupOrder_PickupOrderId: PickupOrder_PickupOrderId,
                    PickupOrder_User_UserId: PickupOrder_User_UserId,
                    Location: Location,
                    Other: Other,
                    Status: "รอการตรวจสอบ",
                    Bill: Bill,
                }
                SubmitForm(obj);



            }

        function SubmitForm(obj) {
            $.ajax({
                url: "/BuyOrder/Post",
                method: "POST",
                data: obj,
                success: function (data) {
                    console.log(data);
                },
                error: function (err) {
                    console.error(err);
                }

            })
    }
    
    </script>
</body>

</html>